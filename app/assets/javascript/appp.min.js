var Adjustment=function(myWorkArea){var barElement=myWorkArea;var settings=settings_tryon;var _adjustmentRef=this;var adjustmentView=null;var sliderNames=["userImageScale","userImageRotate","spacer"];var sliders=[];var isSmall=false;function initPlugin(){EventListener.addEventListener("ADJUSTMENT_STARTED",setupLayout);EventListener.addEventListener("ALL_DONE",destroyAdjustment);EventListener.addEventListener("CHECK_FOR_MOBILE",smallScreenAdjust);EventListener.addEventListener("MULTI_DESTROY",removeAdjustmnet)}function setupLayout(evt){EventListener.dispatch("HIDE_RESIZER",this);makeSmallerPanel()}function makeLargePanel(position){isSmall=false;adjustmentView=jsDom.createNode("div",{id:"tryon_adjustment","class":"adjustment",style:"position:relative;border:1px solid #d3d3d3; display:none;background:#fff; opacity:0.98;width:"+settings.adjustmentPanelWidth+"px;height:"+settings.adjustmentPanelHeight+"px;"},"","parent",previewArea);var location=position=="right"?1:-1;jsDom.css(adjustmentView,{display:"block",left:location*settings.panelwidth+"px","z-index":"10"});for(var k=0;k<sliderNames.length;k++){var marginTop=settings.adjustmentPanelHeight/(sliderNames.length*2);if(k==0){marginTop=((settings.adjustmentPanelHeight/(sliderNames.length))-10)}if(sliderNames[k]=="spacer"){var hr=jsDom.createNode("div",{id:sliderNames[k]},"","parent",adjustmentView);jsDom.css(hr,{width:(settings.adjustmentPanelWidth-20)+"px",position:"relative",left:"10px",right:"10px",marginTop:marginTop+"px",height:"25px",borderTop:"1px solid "+settings.panelbordercolor})}else{var LabelSlider='<span style="margin-top:-30px;font-size:10px;font-family:Arial;color:'+settings.fontcolor+';float:left;">'+settings[sliderNames[k]]+"</span>";var slider=jsDom.createNode("div",{id:"main"+sliderNames[k]},LabelSlider,"parent",adjustmentView);jsDom.css(slider,{position:"relative",height:"25px",marginTop:marginTop+"px",left:"40px",right:"40px",width:(settings.adjustmentPanelWidth-80)+"px"});createSlider(sliderNames[k],slider);var dragSlider=new Dragdealer(sliderNames[k],{x:0.5,animationCallback:function(x,y){if(typeof eval(this.wrapper.id==="function")){eval(this.wrapper.id)(Math.round(x*100))}}});sliders.push(dragSlider)}}}function smallScreenAdjust(){if(isSmall){var okbtn=jsDom.nodeById("tryonok_button");if(okbtn){jsDom.css(okbtn,{position:"absolute",left:"190px",overflow:"visible","margin-left":"0px","z-index":"9999"})}}}function createSlider(strId,elem){var slider=jsDom.createNode("div",{id:strId,"margin-top":"15px"},"","parent",elem);jsDom.css(slider,{position:"relative",height:"1px",background:settings.panelbordercolor});var thumb=jsDom.createNode("div",{"class":"handle"},"","parent",slider);jsDom.css(thumb,{position:"absolute",top:"-13px",left:"0px",cursor:"pointer",width:"25px",height:"25px",background:settings.chromeColor,border:"1px solid "+settings.panelbordercolor,borderRadius:"25px"})}function createsmallSlider(strId,elem){var slider=jsDom.createNode("div",{id:strId,"margin-top":"15px"},"","parent",elem);jsDom.css(slider,{position:"relative",height:"1px",width:144+"px",top:"10px",background:settings.panelbordercolor});var thumb=jsDom.createNode("div",{"class":"handle"},"","parent",slider);jsDom.css(thumb,{position:"absolute",top:"-13px",left:"0px",cursor:"pointer",width:"25px",height:"25px",background:settings.chromeColor,border:"1px solid "+settings.panelbordercolor,borderRadius:"25px"})}function makeSmallerPanel(){isSmall=true;var adArea=jsDom.createNode("div",{id:"smalladjust","class":"dragdealer",style:"overflow:hidden;"},"","parent",barElement,true);jsDom.css(adArea,{width:settings.panelwidth+"px",height:settings.panelheight+"px",bottom:"0px","float":"left",background:settings.panelcolor+""});adjustmentView=jsDom.createNode("div",{id:"tryon_adjustment","class":"handle",style:"opacity:0.98;"},"","parent",adArea);jsDom.css(adjustmentView,{display:"block","margin-top":"20px",width:"400%","list-style-type":"none",height:"100%","margin-left":"10px","float":"left","z-index":"10"});for(var k=0;k<sliderNames.length;k++){var marginTop=settings.adjustmentPanelHeight/(sliderNames.length*2);if(sliderNames[k]!="spacer"){var LabelSlider='<span style="font-size:12px;margin-top:15px;font-weight:bold;position:relative;bottom:30px;font-family:Arial;color:'+settings.fontcolor+';float:left;">'+settings[sliderNames[k]]+"</span>";var slider=jsDom.createNode("div",{id:"main"+sliderNames[k],"class":"slide"},LabelSlider,"parent",adjustmentView);jsDom.css(slider,{"float":"left",position:"relative",width:"25%"});createsmallSlider(sliderNames[k],slider);var dragSlider=new Dragdealer(sliderNames[k],{x:0.5,animationCallback:function(x,y){if(typeof eval(this.wrapper.id==="function")){eval(this.wrapper.id)(Math.round(x*100))}}});sliders.push(dragSlider)}}var dragAdjust=new Dragdealer("smalladjust",{steps:4,speed:0.3,loose:false,requestAnimationFrame:false})}function userImageScale(scale){scale+=50;EventListener.dispatch("SCALING",this,scale)}function userImageRotate(scale){scale=(scale-50)*3.6;EventListener.dispatch("ROTATE",this,scale)}function frameScale(scale){scale+=20;EventListener.dispatch("FRAME_SCALING",this,3*scale)}function frameRotate(scale){scale=(scale-50)*3.6;EventListener.dispatch("FRAME_ROTATE",this,scale)}function destroyAdjustment(){jsDom.remove(jsDom.nodeById("tryon_adjustment"));EventListener.dispatch("ADJUSTMENT_COMPLETE",this);var adpanel=jsDom.nodeById("smalladjust");if(adpanel){jsDom.remove(adpanel)}EventListener.dispatch("APPLY_FRAME",this,settings_tryon.currentFrame,settings_tryon.tryonActive,"1/5")}function removeAdjustmnet(){EventListener.removeEventListener("ADJUSTMENT_STARTED",setupLayout);EventListener.removeEventListener("MULTI_DESTROY",removeAdjustmnet)}function getoffset(el){var _x=0;var _y=0;while(el&&!isNaN(el.offsetLeft)&&!isNaN(el.offsetTop)){_x+=el.offsetLeft-el.scrollLeft;_y+=el.offsetTop-el.scrollTop;el=el.offsetParent}return{top:_y,left:_x}}initPlugin()};function Animate(){}Animate.animate=function(a){console.log("starting up animation");var c=new Date;var b=setInterval(function(){var d=new Date-c;var e=d/a.duration;if(e>1){e=1}var f=a.delta(e);a.step(f);if(e==1){clearInterval(b)}},a.dalay||17)};Animate.move=function(a,c,b){if(!b){b=600}Animate.animate({delay:10,duration:b||1000,delta:circ,step:function(d){a.style.left=c*d+"px"}})};function circ(a){return 1-Math.sin(Math.acos(a))}var CacheImage=function(){var g=this;var d=settings_tryon;var f=window.localStorage!==undefined?true:false;var b="TryonStore";var c="frameData";CacheImage.prototype.saveImage=function(h){if(h.length>2){g.saveUserImage(h)}else{g.saveModelused(h)}};CacheImage.prototype.saveUserImage=function(h){objData={};objData.model="";objData.image=h;objData.lastused="image";objData.frame="";objData.user="";e(objData)};CacheImage.prototype.lastUsed=function(h){objData={};objData.lastUsed=h;e(objData)};CacheImage.prototype.saveModelused=function(h){objData={};objData.model=h;objData.image="";objData.lastused="model";objData.frame="";objData.user="";e(objData)};CacheImage.prototype.getImage=function(h){if(!h){throw"Try to retrive image without callback! not possible";return}a(h)};CacheImage.prototype.saveFrameData=function(i,j){var h={};h.model="";h.image="";h.frame=i;h.user=j;h.lastused="";e(h)};var a=function(k){if(f){var j=localStorage.getItem(b);var h=JSON.parse(j);k(h)}else{var i=jsDom.nodeById("storagedevice")}};var e=function(j){if(f){var h=JSON.parse(localStorage.getItem(b));if(h){j.model=j.model===""?h.model:j.model;j.image=j.image===""?h.image:j.image;j.frame=j.frame===""?h.frame:j.frame;j.user=j.user===""?h.user:j.user;j.lastused=j.lastused===""?h.lastused:j.lastused}localStorage.setItem(b,JSON.stringify(j))}else{var i=jsDom.nodeById("storagedevice")}};CacheImage.prototype.initCache=function(){if(!f){var h='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="120" height="120" id="storagedevice"><param name="movie" value="'+d.storagepath+'" /><param name="wmode" value="transparent" /><!--[if !IE]>--><object type="application/x-shockwave-flash" data="'+d.storagepath+'" width="120" height="120" id="storagedevice"><param name="wmode" value="transparent" /><!--<![endif]--><!--[if !IE]>--></object><!--<![endif]--></object>';jsDom.html(document.body,h)}};this.initCache()};function hookEvent(b,a,c){if(typeof(b)=="string"){b=document.getElementById(b)}if(b==null){return}if(b.addEventListener){b.addEventListener(a,c,false)}else{if(b.attachEvent){b.attachEvent("on"+a,c)}}}function unhookEvent(b,a,c){if(typeof(b)=="string"){b=document.getElementById(b)}if(b==null){return}if(b.removeEventListener){b.removeEventListener(a,c,false)}else{if(b.detachEvent){b.detachEvent("on"+a,c)}}}function cancelEvent(a){a=a?a:window.event;if(a.stopPropagation){a.stopPropagation()}if(a.preventDefault){a.preventDefault()}a.cancelBubble=true;a.cancel=true;a.returnValue=false;return false}function Position(a,b){this.X=a;this.Y=b;this.Add=function(d){var c=new Position(this.X,this.Y);if(d!=null){if(!isNaN(d.X)){c.X+=d.X}if(!isNaN(d.Y)){c.Y+=d.Y}}return c};this.Subtract=function(d){var c=new Position(this.X,this.Y);if(d!=null){if(!isNaN(d.X)){c.X-=d.X}if(!isNaN(d.Y)){c.Y-=d.Y}}return c};this.Min=function(d){var c=new Position(this.X,this.Y);if(d==null){return c}if(!isNaN(d.X)&&this.X>d.X){c.X=d.X}if(!isNaN(d.Y)&&this.Y>d.Y){c.Y=d.Y}return c};this.Max=function(d){var c=new Position(this.X,this.Y);if(d==null){return c}if(!isNaN(d.X)&&this.X<d.X){c.X=d.X}if(!isNaN(d.Y)&&this.Y<d.Y){c.Y=d.Y}return c};this.Bound=function(c,e){var d=this.Max(c);return d.Min(e)};this.Check=function(){var c=new Position(this.X,this.Y);if(isNaN(c.X)){c.X=0}if(isNaN(c.Y)){c.Y=0}return c};this.Apply=function(c){if(typeof(c)=="string"){c=document.getElementById(c)}if(c==null){return}if(!isNaN(this.X)){c.style.left=this.X+"px"}if(!isNaN(this.Y)){c.style.top=this.Y+"px"}}}function absoluteCursorPostion(a){a=a?a:window.event;if(isNaN(window.scrollX)){return new Position(a.clientX+document.documentElement.scrollLeft+document.body.scrollLeft,a.clientY+document.documentElement.scrollTop+document.body.scrollTop)}else{return new Position(a.clientX+window.scrollX,a.clientY+window.scrollY)}}function dragObject(a,d,e,h,l,j,g,c){if(typeof(a)=="string"){a=document.getElementById(a)}if(a==null){return}if(e!=null&&h!=null){var q=e.Min(h);h=e.Max(h);e=q}var p=null;var i=null;var k=false;var n=false;var f=false;function r(t){if(k||!n||f){return}k=true;if(l!=null){l(t,a)}p=absoluteCursorPostion(t);i=new Position(parseInt(a.style.left),parseInt(a.style.top));i=i.Check();hookEvent(document,"mousemove",o);hookEvent(document,"mouseup",b);return cancelEvent(t)}function o(u){if(!k||f){return}var t=absoluteCursorPostion(u);t=t.Add(i).Subtract(p);t=t.Bound(e,h);t.Apply(a);if(j!=null){j(t,a)}return cancelEvent(u)}function b(t){s();return cancelEvent(t)}function s(){if(!k||f){return}unhookEvent(document,"mousemove",o);unhookEvent(document,"mouseup",b);p=null;i=null;if(g!=null){g(a)}k=false}this.Dispose=function(){if(f){return}this.StopListening(true);a=null;d=null;e=null;h=null;l=null;j=null;g=null;f=true};this.StartListening=function(){if(n||f){return}n=true;hookEvent(d,"mousedown",r);d.addEventListener("touchstart",m,true);d.addEventListener("touchmove",m,true);d.addEventListener("touchend",m,true);d.addEventListener("touchcancel",m,true)};this.StopListening=function(t){if(!n||f){return}unhookEvent(d,"mousedown",r);n=false;if(t&&k){s()}};this.IsDragging=function(){return k};this.IsListening=function(){return n};this.IsDisposed=function(){return f};if(typeof(d)=="string"){d=document.getElementById(d)}if(d==null){d=a}if(!c){this.StartListening()}function m(u){var v=u.changedTouches[0];var t=document.createEvent("MouseEvent");t.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[u.type],true,true,window,1,v.screenX,v.screenY,v.clientX,v.clientY,false,false,false,false,0,null);v.target.dispatchEvent(t);u.preventDefault()}}(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{a.Dragdealer=b()}}(this,function(){var j=function(q,p){this.options=this.applyDefaults(p||{});this.bindMethods();this.wrapper=this.getWrapperElement(q);if(!this.wrapper){return}this.handle=this.getHandleElement(this.wrapper,this.options.handleClass);if(!this.handle){return}this.init();this.bindEventListeners()};j.prototype={defaults:{disabled:false,horizontal:true,vertical:false,slide:true,steps:0,snap:false,loose:false,speed:0.1,xPrecision:0,yPrecision:0,handleClass:"handle",css3:true,activeClass:"active",tapping:true},init:function(){if(this.options.css3){o(this.handle)}this.value={prev:[-1,-1],current:[this.options.x||0,this.options.y||0],target:[this.options.x||0,this.options.y||0]};this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]};this.change=[0,0];this.stepRatios=this.calculateStepRatios();this.activity=false;this.dragging=false;this.tapping=false;this.reflow();if(this.options.disabled){this.disable()}},applyDefaults:function(q){for(var p in this.defaults){if(!q.hasOwnProperty(p)){q[p]=this.defaults[p]}}return q},getWrapperElement:function(p){if(typeof(p)=="string"){return document.getElementById(p)}else{return p}},getHandleElement:function(t,p){var r,s,q;if(t.getElementsByClassName){r=t.getElementsByClassName(p);if(r.length>0){return r[0]}}else{s=new RegExp("(^|\\s)"+p+"(\\s|$)");r=t.getElementsByTagName("*");for(q=0;q<r.length;q++){if(s.test(r[q].className)){return r[q]}}}},calculateStepRatios:function(){var p=[];if(this.options.steps>1){for(var q=0;q<=this.options.steps-1;q++){p[q]=q/(this.options.steps-1)}}return p},setWrapperOffset:function(){this.offset.wrapper=c.get(this.wrapper)},calculateBounds:function(){var p={top:this.options.top||0,bottom:-(this.options.bottom||0)+this.wrapper.offsetHeight,left:this.options.left||0,right:-(this.options.right||0)+this.wrapper.offsetWidth};p.availWidth=(p.right-p.left)-this.handle.offsetWidth;p.availHeight=(p.bottom-p.top)-this.handle.offsetHeight;return p},calculateValuePrecision:function(){var p=this.options.xPrecision||Math.abs(this.bounds.availWidth),q=this.options.yPrecision||Math.abs(this.bounds.availHeight);return[p?1/p:0,q?1/q:0]},bindMethods:function(){if(typeof(this.options.customRequestAnimationFrame)==="function"){this.requestAnimationFrame=i(this.options.customRequestAnimationFrame,window)}else{this.requestAnimationFrame=i(h,window)}if(typeof(this.options.customCancelAnimationFrame)==="function"){this.cancelAnimationFrame=i(this.options.customCancelAnimationFrame,window)}else{this.cancelAnimationFrame=i(g,window)}this.animateWithRequestAnimationFrame=i(this.animateWithRequestAnimationFrame,this);this.animate=i(this.animate,this);this.onHandleMouseDown=i(this.onHandleMouseDown,this);this.onHandleTouchStart=i(this.onHandleTouchStart,this);this.onDocumentMouseMove=i(this.onDocumentMouseMove,this);this.onWrapperTouchMove=i(this.onWrapperTouchMove,this);this.onWrapperMouseDown=i(this.onWrapperMouseDown,this);this.onWrapperTouchStart=i(this.onWrapperTouchStart,this);this.onDocumentMouseUp=i(this.onDocumentMouseUp,this);this.onDocumentTouchEnd=i(this.onDocumentTouchEnd,this);this.onHandleClick=i(this.onHandleClick,this);this.onWindowResize=i(this.onWindowResize,this)},bindEventListeners:function(){e(this.handle,"mousedown",this.onHandleMouseDown);e(this.handle,"touchstart",this.onHandleTouchStart);e(document,"mousemove",this.onDocumentMouseMove);e(this.wrapper,"touchmove",this.onWrapperTouchMove);e(this.wrapper,"mousedown",this.onWrapperMouseDown);e(this.wrapper,"touchstart",this.onWrapperTouchStart);e(document,"mouseup",this.onDocumentMouseUp);e(document,"touchend",this.onDocumentTouchEnd);e(this.handle,"click",this.onHandleClick);e(window,"resize",this.onWindowResize);this.animate(false,true);this.interval=this.requestAnimationFrame(this.animateWithRequestAnimationFrame)},unbindEventListeners:function(){b(this.handle,"mousedown",this.onHandleMouseDown);b(this.handle,"touchstart",this.onHandleTouchStart);b(document,"mousemove",this.onDocumentMouseMove);b(this.wrapper,"touchmove",this.onWrapperTouchMove);b(this.wrapper,"mousedown",this.onWrapperMouseDown);b(this.wrapper,"touchstart",this.onWrapperTouchStart);b(document,"mouseup",this.onDocumentMouseUp);b(document,"touchend",this.onDocumentTouchEnd);b(this.handle,"click",this.onHandleClick);b(window,"resize",this.onWindowResize);this.cancelAnimationFrame(this.interval)},onHandleMouseDown:function(p){n.refresh(p);f(p);a(p);this.activity=false;this.startDrag()},onHandleTouchStart:function(p){n.refresh(p);a(p);this.activity=false;this.startDrag()},onDocumentMouseMove:function(p){n.refresh(p);if(this.dragging){this.activity=true}},onWrapperTouchMove:function(p){n.refresh(p);if(!this.activity&&this.draggingOnDisabledAxis()){if(this.dragging){this.stopDrag()}return}f(p);this.activity=true},onWrapperMouseDown:function(p){n.refresh(p);f(p);this.startTap()},onWrapperTouchStart:function(p){n.refresh(p);f(p);this.startTap()},onDocumentMouseUp:function(p){this.stopDrag();this.stopTap()},onDocumentTouchEnd:function(p){this.stopDrag();this.stopTap()},onHandleClick:function(p){if(this.activity){f(p);a(p)}},onWindowResize:function(p){this.reflow()},enable:function(){this.disabled=false;this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=true;this.handle.className+=" disabled"},reflow:function(){this.setWrapperOffset();this.bounds=this.calculateBounds();this.valuePrecision=this.calculateValuePrecision();this.updateOffsetFromValue()},getStep:function(){return[this.getStepNumber(this.value.target[0]),this.getStepNumber(this.value.target[1])]},getValue:function(){return this.value.target},setStep:function(q,r,p){this.setValue(this.options.steps&&q>1?(q-1)/(this.options.steps-1):0,this.options.steps&&r>1?(r-1)/(this.options.steps-1):0,p)},setValue:function(q,r,p){this.setTargetValue([q,r||0]);if(p){this.groupCopy(this.value.current,this.value.target);this.updateOffsetFromValue();this.callAnimationCallback()}},startTap:function(){if(this.disabled||!this.options.tapping){return}this.tapping=true;this.setWrapperOffset();this.setTargetValueByOffset([n.x-this.offset.wrapper[0]-(this.handle.offsetWidth/2),n.y-this.offset.wrapper[1]-(this.handle.offsetHeight/2)])},stopTap:function(){if(this.disabled||!this.tapping){return}this.tapping=false;this.setTargetValue(this.value.current)},startDrag:function(){if(this.disabled){return}this.dragging=true;this.setWrapperOffset();this.offset.mouse=[n.x-c.get(this.handle)[0],n.y-c.get(this.handle)[1]];if(!this.wrapper.className.match(this.options.activeClass)){this.wrapper.className+=" "+this.options.activeClass}},stopDrag:function(){if(this.disabled||!this.dragging){return}this.dragging=false;var q=this.groupClone(this.value.current);if(this.options.slide){var p=this.change;q[0]+=p[0]*4;q[1]+=p[1]*4}this.setTargetValue(q);this.wrapper.className=this.wrapper.className.replace(" "+this.options.activeClass,"")},callAnimationCallback:function(){var p=this.value.current;if(this.options.snap&&this.options.steps>1){p=this.getClosestSteps(p)}if(!this.groupCompare(p,this.value.prev)){if(typeof(this.options.animationCallback)=="function"){this.options.animationCallback.call(this,p[0],p[1])}this.groupCopy(this.value.prev,p)}},callTargetCallback:function(){if(typeof(this.options.callback)=="function"){this.options.callback.call(this,this.value.target[0],this.value.target[1])}},animateWithRequestAnimationFrame:function(p){if(p){this.timeOffset=this.timeStamp?p-this.timeStamp:0;this.timeStamp=p}else{this.timeOffset=25}this.animate();this.interval=this.requestAnimationFrame(this.animateWithRequestAnimationFrame)},animate:function(s,r){if(s&&!this.dragging){return}if(this.dragging){var p=this.groupClone(this.value.target);var q=[n.x-this.offset.wrapper[0]-this.offset.mouse[0],n.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetValueByOffset(q,this.options.loose);this.change=[this.value.target[0]-p[0],this.value.target[1]-p[1]]}if(this.dragging||r){this.groupCopy(this.value.current,this.value.target)}if(this.dragging||this.glide()||r){this.updateOffsetFromValue();this.callAnimationCallback()}},glide:function(){var p=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];if(!p[0]&&!p[1]){return false}if(Math.abs(p[0])>this.valuePrecision[0]||Math.abs(p[1])>this.valuePrecision[1]){this.value.current[0]+=p[0]*this.options.speed*this.timeOffset/25;this.value.current[1]+=p[1]*this.options.speed*this.timeOffset/25}else{this.groupCopy(this.value.current,this.value.target)}return true},updateOffsetFromValue:function(){if(!this.options.snap){this.offset.current=this.getOffsetsByRatios(this.value.current)}else{this.offset.current=this.getOffsetsByRatios(this.getClosestSteps(this.value.current))}if(!this.groupCompare(this.offset.current,this.offset.prev)){this.renderHandlePosition();this.groupCopy(this.offset.prev,this.offset.current)}},renderHandlePosition:function(){var p="";if(this.options.css3&&d.transform){if(this.options.horizontal){p+="translateX("+this.offset.current[0]+"px)"}if(this.options.vertical){p+=" translateY("+this.offset.current[1]+"px)"}this.handle.style[d.transform]=p;return}if(this.options.horizontal){this.handle.style.left=this.offset.current[0]+"px"}if(this.options.vertical){this.handle.style.top=this.offset.current[1]+"px"}},setTargetValue:function(p,r){var q=r?this.getLooseValue(p):this.getProperValue(p);this.groupCopy(this.value.target,q);this.offset.target=this.getOffsetsByRatios(q);this.callTargetCallback()},setTargetValueByOffset:function(r,s){var p=this.getRatiosByOffsets(r);var q=s?this.getLooseValue(p):this.getProperValue(p);this.groupCopy(this.value.target,q);this.offset.target=this.getOffsetsByRatios(q)},getLooseValue:function(q){var p=this.getProperValue(q);return[p[0]+((q[0]-p[0])/4),p[1]+((q[1]-p[1])/4)]},getProperValue:function(q){var p=this.groupClone(q);p[0]=Math.max(p[0],0);p[1]=Math.max(p[1],0);p[0]=Math.min(p[0],1);p[1]=Math.min(p[1],1);if((!this.dragging&&!this.tapping)||this.options.snap){if(this.options.steps>1){p=this.getClosestSteps(p)}}return p},getRatiosByOffsets:function(p){return[this.getRatioByOffset(p[0],this.bounds.availWidth,this.bounds.left),this.getRatioByOffset(p[1],this.bounds.availHeight,this.bounds.top)]},getRatioByOffset:function(r,p,q){return p?(r-q)/p:0},getOffsetsByRatios:function(p){return[this.getOffsetByRatio(p[0],this.bounds.availWidth,this.bounds.left),this.getOffsetByRatio(p[1],this.bounds.availHeight,this.bounds.top)]},getOffsetByRatio:function(q,p,r){return Math.round(q*p)+r},getStepNumber:function(p){return this.getClosestStep(p)*(this.options.steps-1)+1},getClosestSteps:function(p){return[this.getClosestStep(p[0]),this.getClosestStep(p[1])]},getClosestStep:function(s){var p=0;var r=1;for(var q=0;q<=this.options.steps-1;q++){if(Math.abs(this.stepRatios[q]-s)<r){r=Math.abs(this.stepRatios[q]-s);p=q}}return this.stepRatios[p]},groupCompare:function(q,p){return q[0]==p[0]&&q[1]==p[1]},groupCopy:function(q,p){q[0]=p[0];q[1]=p[1]},groupClone:function(p){return[p[0],p[1]]},draggingOnDisabledAxis:function(){return(!this.options.horizontal&&n.xDiff>n.yDiff)||(!this.options.vertical&&n.yDiff>n.xDiff)}};var i=function(q,p){return function(){return q.apply(p,arguments)}};var e=function(p,q,r){if(p.addEventListener){p.addEventListener(q,r,false)}else{if(p.attachEvent){p.attachEvent("on"+q,r)}}};var b=function(p,q,r){if(p.removeEventListener){p.removeEventListener(q,r,false)}else{if(p.detachEvent){p.detachEvent("on"+q,r)}}};var f=function(p){if(!p){p=window.event}if(p.preventDefault){p.preventDefault()}p.returnValue=false};var a=function(p){if(!p){p=window.event}if(p.stopPropagation){p.stopPropagation()}p.cancelBubble=true};var n={x:0,y:0,xDiff:0,yDiff:0,refresh:function(p){if(!p){p=window.event}if(p.type=="mousemove"){this.set(p)}else{if(p.touches){this.set(p.touches[0])}}},set:function(r){var q=this.x,p=this.y;if(r.clientX||r.clientY){this.x=r.clientX;this.y=r.clientY}else{if(r.pageX||r.pageY){this.x=r.pageX-document.body.scrollLeft-document.documentElement.scrollLeft;this.y=r.pageY-document.body.scrollTop-document.documentElement.scrollTop}}this.xDiff=Math.abs(this.x-q);this.yDiff=Math.abs(this.y-p)}};var c={get:function(q){var p={left:0,top:0};if(q.getBoundingClientRect!==undefined){p=q.getBoundingClientRect()}return[p.left,p.top]}};var d={transform:l("transform"),perspective:l("perspective"),backfaceVisibility:l("backfaceVisibility")};function l(s){var r="Webkit Moz ms O".split(" "),q=document.documentElement.style;if(q[s]!==undefined){return s}s=s.charAt(0).toUpperCase()+s.substr(1);for(var p=0;p<r.length;p++){if(q[r[p]+s]!==undefined){return r[p]+s}}}function o(p){if(d.backfaceVisibility&&d.perspective){p.style[d.perspective]="1000px";p.style[d.backfaceVisibility]="hidden"}}var m=["webkit","moz"];var h=window.requestAnimationFrame;var g=window.cancelAnimationFrame;for(var k=0;k<m.length&&!h;++k){h=window[m[k]+"RequestAnimationFrame"];g=window[m[k]+"CancelAnimationFrame"]||window[m[k]+"CancelRequestAnimationFrame"]}if(!h){h=function(p){return setTimeout(p,25)};g=clearTimeout}return j}));var EventListenerClass={};EventListenerClass=function(){this.listeners={}};EventListenerClass.prototype={addEventListener:function(d,f,c){var a=[];var e=arguments.length;for(var b=0;b<e;b++){a.push(arguments[b])}a=a.length>3?a.splice(3,a.length-1):[];if(typeof this.listeners[d]!="undefined"){this.listeners[d].push({scope:c,callback:f,args:a})}else{this.listeners[d]=[{scope:c,callback:f,args:a}]}},destroyEventListener:function(){this.listeners={}},removeEventListener:function(d,g,c){if(typeof this.listeners[d]!="undefined"){var f=this.listeners[d].length;var a=[];for(var b=0;b<f;b++){var e=this.listeners[d][b];if(e.scope==c&&e.callback==g){}else{a.push(e)}}this.listeners[d]=a}},hasEventListener:function(c,f,b){if(typeof this.listeners[c]!="undefined"){var e=this.listeners[c].length;if(f===undefined&&b===undefined){return e>0}for(var a=0;a<e;a++){var d=this.listeners[c][a];if((b?d.scope==b:true)&&d.callback==f){return true}}}return false},dispatch:function(k,g){var h=0;var b={type:k,target:g};var j=[];var a=arguments.length;for(var e=0;e<a;e++){j.push(arguments[e])}j=j.length>2?j.splice(2,j.length-1):[];j=[b].concat(j);if(typeof this.listeners[k]!="undefined"){var f=this.listeners[k].length;for(var e=0;e<f;e++){var c=this.listeners[k][e];if(c&&c.callback){var d=j.concat(c.args);c.callback.apply(c.scope,d);h+=1}}}},getEvents:function(){var e="";for(var b in this.listeners){var d=this.listeners[b].length;for(var a=0;a<d;a++){var c=this.listeners[b][a];e+=c.scope&&c.scope.className?c.scope.className:"anonymous";e+=" listen for '"+b+"'\n"}}return e}};var EventListener=new EventListenerClass();var ImageButton=function(b,a){ImageButton.prototype.makeButton=function(d,c){if(d==null||d==""){return}if(d=="browse"){this.makeBrowseButton(c)}else{this.makeSimpleButton(d,c)}};ImageButton.prototype.makeBrowseButton=function(c){var d='<label style="display:block; overflow:hidden; cursor:pointer"><input type="file" class="file" /></label>'};ImageButton.prototype.makeSimpleButton=function(d,c){}};(function(a){a.jsDom={createNode:function(h,g,b,e,d,c){var f=document.createElement(h);jsDom.setAttr(f,g);if(b){jsDom.html(f,b)}switch(e){case"parent":if(!c){jsDom.append(d,f)}else{jsDom.prepend(d,f)}break;case"child":if(!c){jsDom.append(f,d)}else{jsDom.prepend(f,d)}break;default:break}return f},remove:function(b){var c=jsDom.getNode(b);if(c.firstChild){jsDom.clearNode(c)}c.parentNode.removeChild(c)},clearNode:function(b){while(b.firstChild){b.removeChild(b.firstChild)}},setAttr:function(d,c){var f=jsDom.getNode(d);for(var b in c){if(c.hasOwnProperty(b)){f.setAttribute(b,c[b])}}},html:function(b,c){var d=jsDom.getNode(b);d.innerHTML=c},append:function(b,d){var e=jsDom.getNode(b);var f=jsDom.getNode(d);e.appendChild(f)},prepend:function(b,d){var e=jsDom.getNode(b);var f=jsDom.getNode(d);e.insertBefore(f,e.childNodes[0]||null)},li:function(c,d){var b=document.createElement("li");jsDom.setAttr(b,c);jsDom.html(b,d);return b},liImage:function(f,e,b){var c=jsDom.createNode(f,e);var d=jsDom.createNode("img",b,null,"parent",c);return c},button:function(e,h,b,g,c,i,f){var d=jsDom.createNode("button",h);if(g){var j=jsDom.createNode("img",{src:g},null,"parent",d)}else{jsDom.html(d,b)}e.appendChild(d)},displayById:function(d,c){var b=jsDom.nodeById(d);if(c){jsDom.displayNode(b,c)}return b},displayNode:function(c,b){c.style.display=b},show:function(b){jsDom.getNode(b).style.display="block"},hide:function(b){jsDom.getNode(b).style.display="none"},nodeById:function(d,b){var c=document.getElementById(d);if(b){this.html(c,b)}return c},nodeByClass:function(b){return document.getElementsByClassName(b)},css:function(d,c){var f=jsDom.getNode(d);for(var b in c){if(c.hasOwnProperty(b)){f.style[b]=c[b]}}},getProperty:function(c,g,b){var d=jsDom.getNode(c);var f=d[g];if(b){return jsDom.makeInt(f)}return f},getStyle:function(c,g,b){var d=jsDom.getNode(c);var f=d.style[g];if(b){return jsDom.makeInt(f)}return f},removeStyle:function(b,d){var c=jsDom.getNode(b);c.style.removeProperty(d)},makeInt:function(b){return b==""?0:parseInt(b)},getNode:function(b){if(typeof b!="object"){return jsDom.nodeById(b)}return b},setBGOpacity:function(b,d){var c=jsDom.getNode(b);c.style["-khtml-opacity"]=d/100;c.style["-moz-opacity"]=d/100;c.style["-ms-filter"]="alpha(opacity="+d+")";c.style.filter="alpha(opacity="+d+")";c.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=("+d/100+"))";c.style.opacity=d/100}}})(this);var ModelGallery=function(n){var c=n;var d=settings_tryon;var h=this;var j=null;var b=null;var g=null;var f=null;var p=false;var e=false;var k=navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);var l=0;ModelGallery.prototype.initPlugin=function(){EventListener.addEventListener("AREA_CLICKED",i)};ModelGallery.prototype.setupLayout=function(){p=true;if(e){jsDom.css(j,{display:"block"});if(!k){jsDom.css(b,{display:"block"});jsDom.css(g,{display:"block"})}return}panelheight=(parseInt(d.panelheight)-(2*parseInt(d.panelborder)));if(!k){l=42;b=jsDom.createNode("div",{id:"leftArrow",style:"width:20px; color:#3d3d3d; height:"+panelheight+"px; cursor:pointer; font-size:20px; line-height:"+panelheight+"px; float:left;"},"","parent",c,true);jsDom.html(b,"&#9654;")}j=jsDom.createNode("div",{id:"modelArea",style:"overflow:hidden; float:left;","class":"dragdealer"},"","parent",c,true);jsDom.css(j,{width:(d.panelwidth-l)+"px",height:panelheight+"px",background:d.panelcolor+""});if(!k){g=jsDom.createNode("div",{id:"rightArrow",style:"width:20px;color:#3d3d3d; height:"+panelheight+"px;cursor:pointer; font-size:20px; line-height:"+panelheight+"px; float:left;"},"","parent",c,true);jsDom.html(g,"&#9664;")}o()};function o(){f=jsDom.createNode("ul",{id:"modelVisual","class":"handle",style:"overflow:hidden;margin:0;padding:0;list-style: none;position:relative;left:0px;height: "+(panelheight)+"px;"},"","parent",j);var s=d.modelsimages.split(",");var q=0;var r=0;for(var t=0;t<s.length;t++){var u=s[t].toString().trim();var w=jsDom.createNode("li",{id:"modelThumb"+t,style:"width:auto;height:"+panelheight+"px;cursor:pointer;background-size:25%; float:left;margin-right:5px"},"","parent",f);var v=jsDom.createNode("img",{src:u,style:"width:auto;height:"+(panelheight-6)+"px;padding:2px; border:1px solid #d3d3d3;"},"","parent",w);v.onload=function(){r++;if(this.width<=50){q+=this.width+11}else{q+=(42+11)}if(r>=s.length){m(q)}}}f.addEventListener("click",a)}function a(s){var r=s.target.nodeName;var q=s.target||s.srcElement;if(r=="IMG"){var t=jsDom.getProperty(q,"src");EventListener.dispatch("MODEL_CHOOSEN",this,t,"");EventListener.dispatch("APPLY_FRAME",this,settings_tryon.currentFrame,settings_tryon.tryonActive,"1/5");i()}}function m(q){jsDom.css(f,{width:q+"px"});e=true;var s=1;var r=d.modelsimages.split(",");var t=new Dragdealer("modelArea",{steps:r.length,speed:0.3,loose:true,requestAnimationFrame:true});if(!k){b.addEventListener("click",function(){if(s>r.length){s=r.length;return}else{s++}t.setStep(s)});g.addEventListener("click",function(){if(s<=1){s=0;return}else{s--}t.setStep(s)})}}function i(q){if(p){jsDom.css(j,{display:"none"});if(!k){jsDom.css(b,{display:"none"});jsDom.css(g,{display:"none"})}EventListener.dispatch("GALLERY_CLOSED",this);p=false}}this.initPlugin()};var Resizer=function(r){var d=r;var v=settings_tryon;var q=this;var l=null;var u=100;var f=0;var s="";var k=0;var j=["FrameReset","FrameRotateLeft","FrameRotateRight","FrameScaleUp","FrameScaleDown","space","FacebookShare","TwitterShare","SaveImage"];var g=new ShareView();var i=0;var o=0;Resizer.prototype.initPlugin=function(){c();EventListener.addEventListener("ALL_DONE",m);EventListener.addEventListener("INIT_RESIZER",t);EventListener.addEventListener("HIDE_RESIZER",p);EventListener.addEventListener("OLD_RESIZER",b);EventListener.addEventListener("INIT_RESIZER_VAR",e)};function c(){l=jsDom.createNode("div",{id:"frame_live_resizer",style:"position:relative; display:none;width:"+v.resizerPanelWidth+"px;height:"+v.resizerPanelHeight+"px;"},"","parent",d);jsDom.css(l,{display:"block",top:"5px",left:v.width+"px","z-index":"11",textAlign:"center"});for(var w=0;w<j.length;w++){if(j[w]=="space"){jsDom.createNode("hr",{width:"60%",style:"border:0;height:1px;margin:5px 8px 15px;background-color:"+v.bordercolor+";"},"","parent",l);continue}a(j[w])}}function a(z){var y=z+"Title";var x=jsDom.createNode("span",{"class":"hint--right hint--rounded","data-hint":v[y]},"","parent",l);var w=jsDom.createNode("img",{src:""+v[z]+"",id:z,"class":"resizerpanel"},"","parent",x);jsDom.css(w,{display:"block","margin-bottom":"2px",cursor:"pointer"});w.addEventListener("click",n);w.addEventListener("touchstart",n)}function t(H,w,x,E){u=100;f=0;i=x;o=E;var I=window.getComputedStyle(w,null);var C=I.getPropertyValue("-webkit-transform")||I.getPropertyValue("-moz-transform")||I.getPropertyValue("-ms-transform")||I.getPropertyValue("-o-transform")||I.getPropertyValue("transform")||"none";if(C!="none"){var G=C.split("(")[1].split(")")[0].split(",");var F=G[0];var D=G[1];var B=G[2];var z=G[3];var y=Math.sqrt(F*F+D*D);u=y*100;var A=D/y;f=Math.round(Math.atan2(D,F)*(180/Math.PI))}}function e(){u=100;f=0}function b(w,y,x){y=y;x=x;EventListener.dispatch("FRAME_WITH_RESIZER",this,u,f,y,x)}function n(){var w=this.id;switch(w){case"FrameReset":EventListener.dispatch("FRAME_RESET",this);break;case"FrameRotateLeft":f-=5;EventListener.dispatch("FRAME_ROTATE_LEFT",this,u,f,i,o);break;case"FrameRotateRight":f+=5;EventListener.dispatch("FRAME_ROTATE_RIGHT",this,u,f,i,o);break;case"FrameScaleUp":u+=10;EventListener.dispatch("SCALE_UP",this,u,f,i,o);break;case"FrameScaleDown":u-=10;EventListener.dispatch("SCALE_DOWN",this,u,f,i,o);break;case"FacebookShare":g.savetheImage("fb");break;case"TwitterShare":g.savetheImage("tw");break;case"SaveImage":g.savetheImage("saveonly");break}}function m(){jsDom.css(l,{display:"block"});var x=jsDom.nodeById("frames");var w=jsDom.nodeById("userThumb");if(w){jsDom.css(w,{display:"block"})}if(x){jsDom.css(x,{display:"block"})}}function p(){jsDom.css(l,{display:"none"});var x=jsDom.nodeById("frames");var w=jsDom.nodeById("userThumb");if(w){jsDom.css(w,{display:"none"})}if(x){jsDom.css(x,{display:"none"})}}function h(y){var x=0;var w=0;while(y&&!isNaN(y.offsetLeft)&&!isNaN(y.offsetTop)){x+=y.offsetLeft-y.scrollLeft;w+=y.offsetTop-y.scrollTop;y=y.offsetParent}return{top:w,left:x}}this.initPlugin()};var SaveImage=function(){var a=jsDom.nodeById("mainArea");SaveImage.prototype.setupLayout=function(){};SaveImage.prototype.initSaving=function(){html2canvas([a],{onrendered:function(e){var f=e.toDataURL("image/png");var d=c(f);b(d,"mytryonlook.png")}})};function c(d){var h=atob(d.split(",")[1]);var g=new ArrayBuffer(h.length);var e=new Uint8Array(g);for(var f=0;f<h.length;f++){e[f]=h.charCodeAt(f)}return new Blob([g],{type:"image/png"})}function b(e,f){var d=new FileReader();d.readAsDataURL(e);d.onload=function(h){var g=document.createElement("a");g.setAttribute("download","MyTryOnLook.png");g.href=h.target.result;g.innerHTML="testing";g.style.display="none";document.body.appendChild(g);g.click()}}};var SaveView=function(d){var a=d;var b=settings_tryon;var c=this;SaveView.prototype.initPlugin=function(){EventListener.addEventListener("SAVE_PREVIEW",this.savetheImage)};SaveView.prototype.savetheImage=function(e){};this.initPlugin()};var vpath="./";var settings_tryon={vtopath:vpath,width:"218",height:"300",panelwidth:"258",panelheight:"50",panellocation:"external",modelThumbWidth:"80",swfpath:vpath+"assets/swfs/filebtn.swf",storagepath:vpath+"assets/swfs/StorageDevice.swf",webcampath:vpath+"assets/swfs/webcam.swf",chromeColor:"#d3d3d3",fontcolor:"#000000",panelcolor:"#f6f6f3",panelalpha:"100",panelborder:"1",panelbordercolor:"#c6c5c4",buttons:"browse*"+vpath+"assets/images/upload-image.png,webcam*"+vpath+"assets/images/web-cam.png,modelgallery*"+vpath+"assets/images/group.png",buttonstooltip:"browse*Browse,webcam*Take,modelgallery*Choose",takepicicon:""+vpath+"assets/images/web-cam-click.png",takepicicontooltip:"Click to Shoot",usepictureicon:""+vpath+"assets/images/usepicture.png",usepicturetooltip:"Use Picture",closebutton:""+vpath+"assets/images/cancel.png",discardpicturetooltip:"Retake",closevto:""+vpath+"assets/images/close.png",okbutton:""+vpath+"assets/images/okbutton.png",savebutton:""+vpath+"assets/images/save.png",savebuttontooltip:"Click to save",okbuttontooltip:"Done",closebuttontooltip:"Close",adjustmenterror:"Please set the pupil location!",noCamMsg:"Either you don't have cam or a misconfigured Camera!",permissionDeniedError:"You have denied to access the camera, to restart the cam click the cam icon in the address bar, Allow camera then reload the page",modelsimages:""+vpath+"assets/images/female1.jpg,"+vpath+"assets/images/female2.jpg,"+vpath+"assets/images/female3.jpg,"+vpath+"assets/images/male1.jpg,"+vpath+"assets/images/male2.jpg,"+vpath+"assets/images/male3.jpg",modeldata:"61-105:150-105,82-132:144-132,83-145:135-145,78-139:144-139,77-119:135-119,85-120:151-120",defaultmodel:"4",license:"license.txt",gacode:"",preloader:""+vpath+"assets/images/loader.gif",adjustmenticon:""+vpath+"assets/images/adjustment.png",loadingmsg:"Please wait...",userImageScale:"Resize picture",userImageRotate:"Rotate picture",frameScale:"Resize Frame",frameRotate:"Rotate Frame",adjustmentPanelWidth:"218",adjustmentPanelHeight:"350",resizerPanelHeight:"290",resizerPanelWidth:"40",resizerPanelColor:"#000",resizerPanelOpacity:"0.6",debug:"false",FrameReset:""+vpath+"assets/images/reset.png",FrameResetTitle:"Reset",FrameRotateLeft:""+vpath+"assets/images/rotate-left.png",FrameRotateLeftTitle:"Rotate Left",FrameRotateRight:""+vpath+"assets/images/rotate-right.png",FrameRotateRightTitle:"Rotate Right",FrameScaleUp:""+vpath+"assets/images/zoom-in.png",FrameScaleUpTitle:"Scale Up",FrameScaleDown:""+vpath+"assets/images/zoom-out.png",FrameScaleDownTitle:"Scale Down",FacebookShare:""+vpath+"assets/images/facebook.png",FacebookShareTitle:"Share to Facebook",TwitterShare:""+vpath+"assets/images/twitter.png",TwitterShareTitle:"Share to Twiiter",SaveImage:""+vpath+"assets/images/download.png",SaveImageTitle:"Save Your Look",isShowTitleWithIcon:true,saveFileUrl:"save.php",shareTitle:"My Look With TRY ON",shareDescription:"",shareURL:"http://localhost/projects/TryonMobile/Build/share.php",twitterHashtag:"VirtualTryOn",saveImageTitle:"MyTryOnLook.png",bordercolor:"#000000",fontSize:"10",isPanel:true};var ShareView=function(){var f=settings_tryon;var h="";var a="";ShareView.prototype.initPlugin=function(){EventListener.addEventListener("SHARE_PREVIEW_SCREEN",d)};function d(i){}ShareView.prototype.savetheImage=function(m){var i=jsDom.nodeById(settings_tryon.activeTryon);a=jsDom.nodeById("mainArea");h=jsDom.createNode("img",{src:"assets/vtoplus/assets/images/loader.gif"},"","parent",i,true);jsDom.css(h,{position:"absolute",display:"block",opacity:"1",left:"45%",top:"45%"});jsDom.css(a,{opacity:"0.5"});var k="";var p=jsDom.nodeById("mainArea");var q=jsDom.nodeById("previewImage");var n=q.width;var l=q.height;var j=document.createElement("canvas");j.width=n;j.height=l;var o=q.naturalHeight/q.height;var r=j.getContext("2d");Tools.getTransformData(q,function(t,s){r.save();r.translate(q.width/2,q.height/2);r.rotate(s*Math.PI/180);r.scale(t,t);r.drawImage(q,-q.width/2,-q.height/2,q.width,q.height);c(q,r,j);k=j.toDataURL("image/png")});frame=jsDom.nodeById("frame");if(frame){Tools.getTransformData(frame,function(u,t){var s=parseFloat(frame.style.left)+frame.width/2-parseFloat(q.style.left);var v=parseFloat(frame.style.top)+frame.height/2-parseFloat(q.style.top);r.restore();r.translate(s,v);r.rotate(t*Math.PI/180);r.scale(u,u);r.globalAlpha=0.85;r.drawImage(frame,-1*frame.width/2,-1*frame.height/2,frame.width,frame.height);k=j.toDataURL("image/png");e(m,k)})}else{e(m,k)}};function e(j,k){try{var i;if(window.XMLHttpRequest){i=new XMLHttpRequest()}else{i=new ActiveXObject("Microsoft.XMLHTTP")}i.onreadystatechange=function(){if(i.readyState==4){if(i.status==200){jsDom.remove(h);jsDom.css(a,{opacity:"1"});switch(j){case"tw":b(i.responseText);break;case"fb":g(i.responseText);break;case"saveonly":var m=document.createElement("a");m.setAttribute("download",f.saveImageTitle);m.href=i.responseText;m.setAttribute("target","_blank");m.innerHTML="testing";m.style.display="none";document.body.appendChild(m);m.click();break}}else{if(i.status==400){console.log("There was an error 400")}else{console.log("something else other than 200 was returned")}}}};i.open("POST",f.saveFileUrl,true);i.setRequestHeader("Content-type","application/x-www-form-urlencoded");i.send("img="+k)}catch(l){console.log(l)}}function c(k,l,m){var u=window.getComputedStyle(k,null);var r=u.getPropertyValue("-webkit-filter")||u.getPropertyValue("filter");if(r!="none"){var j=l.getImageData(0,0,m.width,m.height);var n=j.data,t=50;for(var p=0,s=n.length;p<s;p+=4){n[p]+=t;n[p+1]+=t;n[p+2]+=t}var o=65;var q=(259*(o+255))/(255*(259-o));for(var p=0;p<n.length;p+=4){n[p]=q*(n[p]-128)+128;n[p+1]=q*(n[p+1]-128)+128;n[p+2]=q*(n[p+2]-128)+128}l.putImageData(j,0,0)}}function g(i){var k=encodeURIComponent(f.shareURL+"?title="+f.shareTitle+"& desc="+f.shareDescription+" & image="+i);var j="http://www.facebook.com/sharer/sharer.php?u="+k;window.open(j,"_blank")}function b(i){return false}this.initPlugin()};var BTN=(function(){var f=function(j){var g=new Array(Math.ceil(j.length/4));for(var h=0;h<g.length;h++){g[h]=j[h*4]+(j[h*4+1]<<8)+(j[h*4+2]<<16)+(j[h*4+3]<<24)}return g};var e=function(j){var g=[];for(var h=0;h<j.length;h++){g.push(j[h]&255,j[h]>>>8&255,j[h]>>>16&255,j[h]>>>24&255)}return g};var c=function(k){var g="";var j=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];for(var h=0;h<k.length;h++){g+=j[k[h]>>4]+j[k[h]&15]}return g};var b=function(j){var g=[];for(var h=(j.substr(0,2)=="0x")?2:0;h<j.length;h+=2){g.push(parseInt(j.substr(h,2),16))}return g};var d=function(j){var g="";for(var h=0;h<j.length;h++){g+=String.fromCharCode(j[h])}return g};var a=function(j){var g=[];for(var h=0;h<j.length;h++){g.push(j.charCodeAt(h))}return g};return{on:function(g,w){var x=f(a(g));var l=f(a(w));var j=x.length;var i;if(j==0){return""}if(j==1){x[j++]=0}var r=x[j-1],s=x[0],u=2654435769;var t,o,h=Math.floor(6+52/j),m=0;while(h-->0){m+=u;o=m>>>2&3;for(i=0;i<j-1;i++){s=x[i+1];t=(r>>>5^s<<2)+(s>>>3^r<<4)^(m^s)+(l[i&3^o]^r);r=x[i]+=t}s=x[0];t=(r>>>5^s<<2)+(s>>>3^r<<4)^(m^s)+(l[i&3^o]^r);r=x[j-1]+=t}return c(e(x))},off:function(g,w){var x=f(b(g));var l=f(a(w));var j=x.length;var i;if(j==0){return""}var r=x[j-1],s=x[0],u=2654435769;var t,o,h=Math.floor(6+52/j);var m=h*u;while(m!=0){o=m>>>2&3;for(i=j-1;i>0;i--){r=x[i-1];t=(r>>>5^s<<2)+(s>>>3^r<<4)^(m^s)+(l[i&3^o]^r);s=x[i]-=t}r=x[j-1];t=(r>>>5^s<<2)+(s>>>3^r<<4)^(m^s)+(l[i&3^o]^r);s=x[0]-=t;m-=u}return d(e(x))}}})();var Tools=(function(){var b=function(e,h){var f=document.createElement("canvas");f.width=e.width;f.height=e.height;var d=f.getContext("2d");d.imageSmoothingEnabled=true;d.mozImageSmoothingEnabled=true;d.oImageSmoothingEnabled=true;d.webkitImageSmoothingEnabled=true;d.drawImage(e,0,0,e.width,e.height);var g=document.createElement("canvas");g.width=e.width*h;g.height=e.height*h;var c=g.getContext("2d");d.globalAlpha=0.5;c.imageSmoothingEnabled=true;c.mozImageSmoothingEnabled=true;c.oImageSmoothingEnabled=true;c.webkitImageSmoothingEnabled=true;c.drawImage(f,0,0,e.width*h,e.height*h);d.globalCompositeOperation="overlay";d.drawImage(g,0,0,e.width,e.height);return f.toDataURL("image/png")};return{reduceImage:function(c,d){return b(c,d)}};var a=function(f,i){var h=1;var e=0;var r=window.getComputedStyle(f,null);var n=r.getPropertyValue("-webkit-transform")||r.getPropertyValue("-moz-transform")||r.getPropertyValue("-ms-transform")||r.getPropertyValue("-o-transform")||r.getPropertyValue("transform")||"FAIL";if(n!="none"){console.log(n);var q=n.split("(")[1].split(")")[0].split(",");var p=q[0];var o=q[1];var m=q[2];var k=q[3];h=Math.sqrt(p*p+o*o);var j=h*100;var l=o/h;var g=Math.round(Math.atan2(o,p)*(180/Math.PI));e=g}i(h,e)};return{getTransformdata:function(d,c){return a(d,c)}}})();var Tryon=function(){var d=settings_tryon;var a=null;var b=null;var g=null;var e=null;var f=null;Tryon.prototype.initApp=function(i,h){c(i,h)};function c(k,j){f=k;var l=jsDom.nodeById(k);var h=0;var k=l;jsDom.css(k,{position:"relative"});if(d.debug=="true"){jsDom.css(k,{border:"1px dashed #f00"})}a=new TryonPreview(k,h);b=new Adjustment(j,h);if(d.isPanel===true){g=new Resizer(k,h)}barElement=jsDom.nodeById(j);bars=barElement;e=new TryonBar(bars);var m='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"><defs><filter id="contrast"><feGaussianBlur stdDeviation="1.5"/><feComponentTransfer><feFuncR type="discrete" tableValues="0 .5 1 1"/><feFuncG type="discrete" tableValues="0 .5 1"/><feFuncB type="discrete" tableValues="0"/></feComponentTransfer></filter><filter id="brightness"><feComponentTransfer><feFuncR type="linear" slope="4"/><feFuncG type="linear" slope="4"/><feFuncB type="linear" slope="4"/></feComponentTransfer></filter></defs> </svg>';var i=jsDom.createNode("div",{id:"tryon_filters"},m,"parent",document.body)}Tryon.prototype.destroyByID=function(i){var h=document.getElementById(i);h.innerHTML=""};Tryon.prototype.destroyAll=function(){var l=jsDom.nodeByClass("tryon");for(var j=l.length-1;j>=0;j--){l[j].innerHTML=""}var h=jsDom.nodeByClass("tryon-bar");for(var j=h.length-1;j>=0;j--){h[j].innerHTML=""}var m=jsDom.nodeByClass("adjustment");if(m){for(var j=m.length-1;j>=0;j--){jsDom.remove(m[j])}a=null;b=null;g=null;e=null;f=null;EventListener.destroyEventListener()}var k=jsDom.nodeById("tryon_filters");jsDom.remove(k)}};function flashNotify(a){switch(a){case"error":EventListener.dispatch("noCamFound",this);break;case"webcamLoadComplete":break;case"webcamLive":EventListener.dispatch("WEBCAM_READY",this);break;case"webcamDenied":EventListener.dispatch("FLASH_CAM_DENIED",this);EventListener.dispatch("cameraPermissionDenied",this);break}}function getBitmap(b,a){EventListener.dispatch("FILE_LOAD_COMPLETE",this,b,a);EventListener.dispatch("ADJUSTMENT_STARTED",this)}function LoadingStart(){EventListener.dispatch("FILE_LOADING_INIT",this)}function IOError(){alert("error in loading")}String.prototype.toDOM=function(){var g=document,f,e=g.createElement("div"),c=g.createDocumentFragment();e.innerHTML=this;while(f=e.firstChild){c.appendChild(f)}return c};var TryonBar=function(s){var C=s;var J=settings_tryon;var j=0;var A=[];var e=[];var B=this;var d=null;var l=null;var r=null;var c=null;var n=null;var p=false;var b="";var D=navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i);TryonBar.prototype.setupLayout=function(){A=[];if(J.isPanel===true){jsDom.css(C,{"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"});jsDom.css(C,{width:(parseInt(J.panelwidth)-(2*parseInt(J.panelborder)))+"px",height:(parseInt(J.panelheight)-(2*parseInt(J.panelborder)))+"px",background:J.panelcolor+""})}else{J.panelwidth=J.width;jsDom.css(C,{"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"});jsDom.css(C,{width:(parseInt(J.panelwidth)-(2*parseInt(J.panelborder)))+"px",height:(parseInt(J.panelheight)-(2*parseInt(J.panelborder)))+"px",background:J.panelcolor+""})}jsDom.css(C,{position:"relative"});jsDom.setBGOpacity(C,parseInt(J.panelalpha));if(J.panellocation=="inside"){jsDom.css(C,{bottom:J.panelheight+"px"})}d=new ModelGallery(C);a(D);EventListener.addEventListener("RESET_VIEW_DEFAULT",q);EventListener.addEventListener("WEBCAM_READY",g);EventListener.addEventListener("ADJUSTMENT_STARTED",u);EventListener.addEventListener("WEBCAM_CLOSED",k);EventListener.addEventListener("GALLERY_CLOSED",z)};function g(){p=true}function k(){p=false}function a(M){n=jsDom.createNode("div",{id:"mainPanelArea"},"","parent",C,true);jsDom.css(n,{position:"absolute",left:"-9px"});var P=J.buttons.split(",");var L=J.buttonstooltip.split(",");P.reverse();L.reverse();if(M){P.splice(1,1)}j=P.length;for(var O=P.length-1;O>=0;O--){var K=P[O].split("*");var N=L[O].split("*");A.push(K[0]);if(K[0]=="browse"){f(K[1],N[1],y)}else{if(J.isShowTitleWithIcon){t(K[0],K[1],N[1],y,true)}else{I(K[0],K[1],O,y)}}}}function t(L,O,N,P){var M="";var K=new Image();K.onload=function(){labelHeight=parseInt(J.fontSize);this.width+=labelHeight;this.height+=labelHeight;var R=((parseInt(J.panelwidth)+(parseInt(J.panelborder)*2))/j)/2;var Q=(parseInt(J.panelheight)-this.height)/2;M='<label id="tryon'+L+'" style="display:block;line-height:1;font-size:'+J.fontSize+"px; float:left; margin-top:"+Q+"px; margin-left:"+R+"px; overflow:hidden; cursor:pointer; width:"+this.width+"px;height:"+this.height+"px;background-image:url("+O+');background-position:center top;z-index:9999;background-repeat:no-repeat;"><span class="tool">'+N+"</span></label>";if(P){P(M,L)}};K.src=O}function y(O,K){var M=O.toDOM();e[K]=M;var N=Object.keys(e).length;if(N>=j){for(var L=0;L<A.length;L++){jsDom.append(n,e[A[L]]);F(A[L],B)}}}function f(N,M,O){var L="";var K=new Image();K.onload=function(){var Q=((parseInt(J.panelwidth)+(parseInt(J.panelborder)*2))/j)/2;var R=0;if(J.isShowTitleWithIcon){R=parseInt(J.fontSize);this.width+=R;this.height+=R}var P=(parseInt(J.panelheight)-this.height)/2;if(window.File&&window.FileReader&&window.FileList&&window.Blob){L='<label style="display:block; float:left;line-height:1; font-size:'+J.fontSize+"px; margin-top:"+P+"px; margin-left:"+Q+"px; overflow:hidden; cursor:pointer; width:"+this.width+"px;height:"+this.height+"px;background-image:url("+N+');background-position:center top; background-repeat:no-repeat;"><input type="file" id="tryonbrowse" size="2" style="position:relative;margin:0; cursor:pointer; height:'+(this.height-R)+"px;width: "+this.width+'px;opacity: 0;-moz-opacity: 0;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" accept="image/*" /><span class="tool"style="top:0px">'+M+"</span></label>"}else{L='<label style="display:block; float:left;line-height:1; margin-top:'+P+"px; margin-left:"+Q+"px; overflow:hidden; cursor:pointer; width:"+this.width+"px;height:"+this.height+"px;background-image:url("+N+');background-position:center top; background-repeat:no-repeat;"><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.width+'" height="'+this.height+'" id="browsebtn"><param name="loop" value="false"/><param name="movie" value="'+J.swfpath+'" /><param name="wmode" value="transparent" /><param name="loop" value="false"/><!--[if !IE]>--><object type="application/x-shockwave-flash" data="'+J.swfpath+'" width="'+this.width+'" height="'+this.height+'" class="" align=""><param name="wmode" value="transparent" /><param name="loop" value="false"/><param name="flashvars" value="" /><!--<![endif]--><!--[if !IE]>--></object><!--<![endif]-->'+M+"</label>"}if(O){O(L,"browse")}};K.src=N}function I(M,P,K,Q,O){var N="";var L=new Image();L.onload=function(){if(M=="ok_button"){var S=((parseInt(J.panelwidth)+(parseInt(J.panelborder)*2))/j)/2-(this.width)/2}else{var S=((parseInt(J.panelwidth)+(parseInt(J.panelborder)*2))/j)/2-(this.width)/2}var R=(parseInt(J.panelheight)-this.height)/2;if(O){N='<label id="tryon'+M+'" style="display:block;line-height:1; float:left; margin-top:'+R+"px; margin-left:"+S+"px; overflow:hidden; cursor:pointer; width:"+this.width+"px;height:"+this.height+"px;background-image:url("+P+');"></label>'}else{N='<label id="tryon'+M+'" style="display:block;line-height:1; float:left; margin-top:'+R+"px; margin-left:"+S+"px; overflow:hidden; cursor:pointer; width:"+this.width+"px;height:"+this.height+"px;background-image:url("+P+');"></label>'}if(Q){Q(N,M)}};L.src=P}function F(L){var K=jsDom.nodeById("tryon"+L);if(L=="browse"){if(window.FileReader&&window.FileList&&window.Blob){K.addEventListener("change",function(M){G(M)})}}else{K.addEventListener("click",function(M){G(M)});if(!D){K.addEventListener("touchstart",function(M){G(M)})}}}function G(K){var L=K.target.id.split("tryon").join("");switch(L){case"browse":EventListener.dispatch("FILE_LOAD_COMPLETE",this,K.target.files,"");break;case"modelgallery":jsDom.css(n,{display:"none"});d.setupLayout();break;case"webcam":EventListener.dispatch("WEBCAM_OPEN",this);E();break;case"take_pic":if(p){EventListener.dispatch("WEBCAM_TAKE_PICTURE",this);w()}else{EventListener.dispatch("requestAllowCamera",this)}break;case"close_cam":if(p){EventListener.dispatch("WEBCAM_CLOSE",this);H()}else{EventListener.dispatch("requestAllowCamera",this)}break;case"use_pic":EventListener.dispatch("ADJUSTMENT_STARTED",this);break;case"retake":EventListener.dispatch("WEBCAM_RETAKE",this);E();break;case"ok_button":EventListener.dispatch("ALL_DONE",this);H();break}}function i(){return this.id}function E(){jsDom.css(n,{display:"none"});var K=(parseInt(J.panelheight)-(2*parseInt(J.panelborder)));l=jsDom.createNode("div",{id:"webcambarArea",style:"overflow:hidden;"},"","parent",C,true);jsDom.css(l,{width:J.panelwidth+"px",height:K+"px",background:J.panelcolor+""});m()}function u(){jsDom.css(n,{display:"none"});var K=(parseInt(J.panelheight)-(2*parseInt(J.panelborder)));r=jsDom.createNode("div",{id:"adjustArea",style:"overflow:hidden;"},"","parent",C,true);jsDom.css(r,{width:J.panelwidth+"px",background:J.panelcolor+""});j=1;I("ok_button",J.okbutton,"",x)}function H(){jsDom.css(n,{display:"block"});l=jsDom.nodeById("webcambarArea");if(l!==null){jsDom.remove(l);l=null}if(r!==null){jsDom.remove(r);r=null}if(c!==null){jsDom.remove(c);c=null}}function w(){jsDom.remove(l);var K=(parseInt(J.panelheight)-(2*parseInt(J.panelborder)));c=jsDom.createNode("div",{id:"confirmationArea",style:"overflow:hidden;"},"","parent",C,true);jsDom.css(c,{width:J.panelwidth+"px",height:K+"px",background:J.panelcolor+""});h()}function m(){j=2;var K=J.takepicicon;var L=J.closebutton;if(J.isShowTitleWithIcon){t("take_pic",K,J.takepicicontooltip,v);t("close_cam",L,J.closebuttontooltip,v)}else{I("take_pic",K,"",v);I("close_cam",L,"",v)}}function v(M,K){if(c!==null){jsDom.remove(c);c=null}var L=M.toDOM();jsDom.append(l,L);F(K)}function q(K){H()}function h(K){var L=J.usepictureicon;var M=J.closebutton;if(J.isShowTitleWithIcon){t("use_pic",L,J.usepicturetooltip,o);t("retake",M,J.discardpicturetooltip,o)}else{I("use_pic",L,"",o);I("retake",M,"",o)}}function o(M,K){var L=M.toDOM();jsDom.append(c,L);F(K)}function x(M,K){var L=M.toDOM();jsDom.append(r,L);F(K);if(c!==null){jsDom.remove(c);c=null}if(K=="ok_button"){EventListener.dispatch("CHECK_FOR_MOBILE",this)}}function z(){H()}this.setupLayout()};var TryonPreview=function(B){var s=B;var al=settings_tryon;var G=this;var D=null;var Z=null;var ap=new CacheImage();var n=null;var m=null;var Y=null;var R=null;var F=100;var k=0;var H=100;var A=0;var ad=null;var X=null;var aj=null;var M=null;var ak=false;var K=false;var g="";var ao="";var J=false;var N=null;var q=false;var y=null;var i=0;var W=null;var c="";var f=" ";var T=true;var Q="";var ar=true;TryonPreview.prototype.setupLayout=function(){D=jsDom.createNode("div",{id:"mainArea"},"","parent",s);jsDom.css(s,{width:al.width+"px",height:al.height+"px"});jsDom.css(D,{overflow:"hidden",position:"absolute",width:al.width+"px",height:al.height+"px"});O();EventListener.addEventListener("FILE_LOAD_COMPLETE",p);EventListener.addEventListener("FILE_LOADING_INIT",an);EventListener.addEventListener("MODEL_CHOOSEN",C);EventListener.addEventListener("WEBCAM_OPEN",d);EventListener.addEventListener("ASK_FOR_CONFIRM",h);EventListener.addEventListener("RESET_VIEW_DEFAULT",I);EventListener.addEventListener("WEBCAM_CLOSE",I);EventListener.addEventListener("WEBCAM_RETAKE",d);EventListener.addEventListener("ADJUSTMENT_STARTED",v);EventListener.addEventListener("ALL_DONE",ag);EventListener.addEventListener("SCALING",ae);EventListener.addEventListener("ROTATE",e);EventListener.addEventListener("FRAME_SCALING",ac);EventListener.addEventListener("FRAME_ROTATE",S);EventListener.addEventListener("APPLY_FRAME",o);EventListener.addEventListener("SCALE_UP",af);EventListener.addEventListener("SCALE_DOWN",z);EventListener.addEventListener("FRAME_ROTATE_LEFT",u);EventListener.addEventListener("FRAME_ROTATE_RIGHT",r);EventListener.addEventListener("FRAME_RESET",w);EventListener.addEventListener("FRAME_WITH_RESIZER",V);N=null;ap.getImage(ab);D.addEventListener("click",l);D.addEventListener("touchstart",l)};function d(at){jsDom.clearNode(D);O();if(Z!=null){Z.setupCam()}else{Z=new WebcamToImage(D)}}function I(at){ap.getImage(ab)}function an(at){O()}function p(au,av,aw){O();if(window.File&&window.FileReader&&window.FileList&&window.Blob){var at=new FileReader();at.onload=t;at.readAsDataURL(av[0]);ak=true}else{var ax="data:image/"+aw+";base64,"+av;ab(ax);ai(ax)}if(W!==null){jsDom.remove(W)}}function t(at){ab(at.target.result);ai(at.target.result)}function b(){jsDom.hide(jsDom.nodeById("imageprelaoder"));var au=this.naturalWidth;var aw=this.naturalHeight;var av=jsDom.getStyle(s,"width",true);var ax=jsDom.getStyle(s,"height",true);var at=a(au,aw,av,ax,false);if(at){n.width=at.width;n.height=at.height;jsDom.css(n,{left:at.targetleft+"px"});jsDom.css(n,{top:at.targettop+"px"});jsDom.css(n,{display:"block"});EventListener.dispatch("APPLY_FRAME",this,settings_tryon.currentFrame,settings_tryon.tryonActive,"1/5");if(J){jsDom.css(n,{cssText:N.user});g=N.frame;EventListener.dispatch("APPLY_FRAME",this,settings_tryon.currentFrame,settings_tryon.tryonActive,"1/5")}if(ak){EventListener.dispatch("ADJUSTMENT_STARTED",G);ak=false;return}}}function ai(at){J=false;ap.saveImage(at)}function ab(at){if(at){var aw="";if(at.hasOwnProperty("lastused")){if(at.lastused!=="image"){J=false;modelToload=at[at.lastused];var av=al.modelsimages.split(",");aw=av[modelToload];i=parseInt(at[at.lastused]);if(at.image!==""){aq(at)}K=true;y=null}else{J=true;N=at;aw=at[at.lastused];K=false}}else{J=false;aw=at;K=false}jsDom.clearNode(D);O();var au=new Image();au.onload=function(){var ax=Tools.reduceImage(au,0.6);var ay=jsDom.nodeById("previewImage");jsDom.setAttr(ay,{src:ax})};au.crossOrigin="Anonymous";au.src=aw;n=jsDom.createNode("img",{id:"previewImage",src:aw,style:"position:absolute;display:none;"},"","parent",D);n.onload=b}else{L(null);K=true;y=null}}function L(av){if(!av){av=al.defaultmodel}var at=al.modelsimages.split(",");var au=at[parseInt(av)];i=av;ab(au);ai(i)}function C(at,az){O();ab(az);var au=al.modelsimages.split(",");var ay=0;for(var av=0;av<au.length;av++){var ax=au[av].split("/");var aw=ax[ax.length-1];if(az.indexOf(aw)>-1){K=true;i=ay=av;break}}ap.getImage(aq);ap.saveImage(ay)}function O(){var at=jsDom.createNode("div",{id:"imageprelaoder",style:"font-family:Arial;position:absolute;font-size:12px;color:"+al.fontcolor+";text-align:center;line-height:"+(parseInt(al.height)+parseInt(al.panelheight))+"px;width:100%;height:100%;background:url('"+al.preloader+"') no-repeat 50% 50%;"},al.loadingmsg,"parent",D)}function l(at){EventListener.dispatch("AREA_CLICKED",this)}function h(at,av,au){K=false;T=false;jsDom.clearNode(D);n=jsDom.createNode("img",{id:"previewImage",src:av,style:"position:absolute;display:none;text-align:center;"},"","parent",D);if(au){if(au.enhancelight){P(n,true)}}O();n.onload=b;ai(av);ak=false}function a(ax,aC,aB,aw,av){var aD={width:0,height:0,fScaleToTargetWidth:true};if((ax<=0)||(aC<=0)||(aB<=0)||(aw<=0)){return aD}var au=aB;var aA=(aC*aB)/ax;var at=(ax*aw)/aC;var az=aw;var ay=(at>aB);if(ay){ay=av}else{ay=!av}if(ay){aD.width=Math.floor(au);aD.height=Math.floor(aA);aD.fScaleToTargetWidth=true}else{aD.width=Math.floor(at);aD.height=Math.floor(az);aD.fScaleToTargetWidth=false}aD.targetleft=Math.floor((aB-aD.width)/2);aD.targettop=Math.floor((aw-aD.height)/2);return aD}function U(au,at){if(at){q=at}}function P(au,at){if(at){jsDom.css(au,{filter:"url(#brightness)","-webkit-filter":" brightness(150%)"})}}function v(at){if(ar==false){aj=jsDom.createNode("img",{id:"dummy_left",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABf0lEQVQ4jZWSP0hCURTGf0dCCISEWiwCI9AoxE1wCF8uIkQtRVttzba4NNTSXGM2tvUHtAhCif5MgdAQb7GGRCRqiCgSBJfT4POBPnrVB5fL4XznO+fe84ELVDWhqgk3Tp9bEjCs++YXXlfXqKrm1Ym8qkZ7+dJTPE/V3OHywKR8/tLFjKUDJJcijEUyInLiEFDVKG/Px6zPXbqOuHWaZGhkQUTuATx2otXMsZst2/FkfJDRCZ9DYDdbptXMdUKP1T3Bk+mnXmnYxMW1OMmlsEOgXmnwZPo72+lMYPD+2nCQf0KbawD0qeqVFdz9WaCNTVU1PCIyA2T+WQyQEZGZjpEKBKeyDkpkOsTGYQCAu4tHzvYeAQhOBYACWE4UkZqqloilA/b+j7Zv8fm9tthL9Qto+2F4vCQiNej2wQCtZpHiftPu1IvZ1RCp5X68/SkR+ewSsEVgh6ppUC4+0PhoAeDze4mlwoxFrq23f7r+jqquWN6vWievqiuuRS5CroXfPpC2JqI4riYAAAAASUVORK5CYII="}," ","parent",D);jsDom.css(aj,{left:"40px",position:"absolute",top:"70px"});M=jsDom.createNode("img",{id:"dummy_right",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABzUlEQVQ4jYWTT0hUURTGf2ewseTJWCj0lMEx+/MgxsFFkkQos2uRFQQuZ/qzyIWgmzZBkOTGAoW2EbQKoXBqE21MNxkPImIIH1KWDFmRmTGPIjenxbwm7zx5Hrib833nO9+5516ICFXNqWouilMXBQKpHfBtu2ZUdUbDMaOqmVq+1BSf4UNxitnpIu7Tzwaz55RNdjBNR3pERB6HBFQ1w9qnh1wbmI20OP4kS3PbeRF5Ywr8+fWSicvvKXk+ScciO3ikWrTorlYdJR2Lq3c7pb7hOEAs6N7HcrGJkucDYHc04hxrp7S0BsClm6dJOhYAJc9nudikqn0AseBi8qx/8UN2/Y1NFt3VUL7Czatqpg7IA/3Ad4O0a3c9JwYOc6ArxfTtZ1V3/6Mf2IiJyCgwxb79lgGX18tMDs3z9sUSJ8+lDSx11AZGRGQ0FqTmaDvUalj/ulJx9GDiFVBZI0CiJU5rZwMwB+Yan+O5NpND86GZt8aVW710Zx+JyI1agQRQwHNt7l1f4Oe3TaMw0RLn4lgvTs+CiFz4lzZeYiCUo/zjDu9ef+S3XxHZY8U52J2ice+wiNzfyg8JBCLtwNngABSAgoisRI63nZudvvNfuvW/5I2aJFYAAAAASUVORK5CYII="}," ","parent",D);jsDom.css(M,{left:"145px",position:"absolute",top:"70px"});ad=new dragObject("previewImage");m=new dragObject("dummy_left");Y=new dragObject("dummy_right");if(T){jsDom.remove(y);T=false}}if(T){jsDom.remove(y);T=false}ad=new dragObject("previewImage")}function ae(at,au){F=au;j(n,k,au)}function e(at,au){k=au;j(n,au,F)}function ac(at,au){H=au;j(R,A,au)}function S(at,au){A=au;j(R,au,H)}function j(av,au,at){var aw="0";if(q){aw="0"}jsDom.css(av,{"-ms-transform":"rotate("+au+"deg) scale("+at/100+", "+at/100+") rotateY("+aw+"deg)","-webkit-transform":"rotate("+au+"deg) scale("+at/100+", "+at/100+") rotateY("+aw+"deg)",transform:"rotate("+au+"deg) scale("+at/100+", "+at/100+") rotateY("+aw+"deg)"})}function am(au,ax){var aw=1;var at=0;var aG=window.getComputedStyle(au,null);var aC=aG.getPropertyValue("-webkit-transform")||aG.getPropertyValue("-moz-transform")||aG.getPropertyValue("-ms-transform")||aG.getPropertyValue("-o-transform")||aG.getPropertyValue("transform")||"FAIL";if(aC!="none"){console.log(aC);var aF=aC.split("(")[1].split(")")[0].split(",");var aE=aF[0];var aD=aF[1];var aB=aF[2];var az=aF[3];aw=Math.sqrt(aE*aE+aD*aD);var ay=aw*100;var aA=aD/aw;var av=Math.round(Math.atan2(aD,aE)*(180/Math.PI));at=av}ax(aw,at)}function ag(){if(ar==false){ah();aa()}else{var ay="";var az=jsDom.nodeById("previewImage");var av=az.width;var aw=az.height;var au=document.createElement("canvas");au.width=av;au.height=aw;var ax=az.naturalHeight/az.height;var at=au.getContext("2d");am(az,function(aC,aA){at.save();at.translate(az.width/2,az.height/2);at.rotate(aA*Math.PI/180);at.scale(aC,aC);at.drawImage(az,-az.width/2,-az.height/2,az.width,az.height);ay=au.toDataURL("image/png");var aB=new Image();aB.src=ay;aB.id="trackingImage";aB.style.display="none";aB.width=av;aB.height=aw;jsDom.nodeById("mainArea").appendChild(aB);aB.onload=function(){var aE=new tracking.ObjectTracker(["eye"]);aE.setStepSize(1.7);tracking.track("#trackingImage",aE);aE.on("track",function(aF){if(aF.data.length==0){ar=false;EventListener.dispatch("ADJUSTMENT_STARTED",this)}aF.data.forEach(function(aG){window.plot(aG.x,aG.y,aG.width,aG.height)})});var aD=0;window.plot=function(aF,aI,aG,aH){Q=document.createElement("div");document.getElementById("mainArea").appendChild(Q);if(Q.style){Q.id="rect"+aD}Q.style.width=aG+"px";Q.style.height=aH+"px";Q.style.left=(n.offsetLeft+aF)+"px";Q.style.top=(n.offsetTop+aI)+"px";Q.style.position="absolute";aD++;if(aD==2){ah()}}}})}}function ah(){if(ar==false){var av={};av.Lleft=aj.style.left.split("px").join("");av.Ltop=aj.style.top.split("px").join("");av.Rleft=M.style.left.split("px").join("");av.Rtop=M.style.top.split("px").join("");g=av;ao=n.style.cssText;ap.saveFrameData(g,ao)}else{var au=jsDom.nodeById("rect0");var at=jsDom.nodeById("rect1");var av={};if(parseInt(au.style.left.split("px").join(""))<parseInt(at.style.left.split("px").join(""))){av.Lleft=parseInt(parseInt(au.style.left.split("px").join(""))+parseInt(au.style.width.split("px").join(""))/2);av.Ltop=parseInt(parseInt(au.style.top.split("px").join(""))+parseInt(au.style.height.split("px").join(""))/2);av.Rleft=parseInt(parseInt(at.style.left.split("px").join(""))+parseInt(at.style.width.split("px").join(""))/2);av.Rtop=parseInt(parseInt(at.style.top.split("px").join(""))+parseInt(at.style.height.split("px").join(""))/2)}else{av.Lleft=parseInt(parseInt(at.style.left.split("px").join(""))+parseInt(at.style.width.split("px").join(""))/2);av.Ltop=parseInt(parseInt(at.style.top.split("px").join(""))+parseInt(at.style.height.split("px").join(""))/2);av.Rleft=parseInt(parseInt(au.style.left.split("px").join(""))+parseInt(au.style.width.split("px").join(""))/2);av.Rtop=parseInt(parseInt(au.style.top.split("px").join(""))+parseInt(au.style.height.split("px").join(""))/2)}if(jsDom.nodeById("trackingImage")){jsDom.remove(jsDom.nodeById("trackingImage"))}g=av;ao=n.style.cssText;console.log(ao);ap.saveFrameData(g,ao);EventListener.dispatch("APPLY_FRAME",this,settings_tryon.currentFrame,settings_tryon.tryonActive,"1/5");aa()}}function aa(){if(ar==false){ar=true;ad.StopListening(true);m.StopListening(true);Y.StopListening(true);if(aj&&M){jsDom.remove(aj);jsDom.remove(M);aj=null;M=null}ak=false}else{ad.StopListening(true);var au=jsDom.nodeById("rect0");var at=jsDom.nodeById("rect1");if(au&&at){jsDom.remove(au);jsDom.remove(at);au=null;at=null}ak=false}}function x(){var at=jsDom.createNode("div",{id:"adjustButton",style:"position: absolute; cursor:pointer; width:18px;height:18px;overflow:hidden; bottom: 5px;left:5px;"},"","parent",s);jsDom.html(at,'<img src="'+al.adjustmenticon+'" width="100%" height="100%"/>');at.addEventListener("click",function(){EventListener.dispatch("ADJUSTMENT_STARTED",G);y=jsDom.nodeById("frame");if(y!=null){jsDom.remove(y)}jsDom.remove(this)});at.addEventListener("touchstart",function(){EventListener.dispatch("ADJUSTMENT_STARTED",G);y=jsDom.nodeById("frame");if(y!=null){jsDom.remove(y)}jsDom.remove(this)})}function aq(at){if(at.image===""){return}var aw=jsDom.nodeById("userThumb");if(aw!=null){jsDom.remove(aw)}aw=jsDom.createNode("div",{id:"userThumb",style:"position: absolute; overflow:hidden;cursor:pointer; width: 40px; height:auto; bottom: 5px;right: 5px;"},"","parent",s);jsDom.html(aw,'<img src="'+at.image+'" id="userimage" style="display:none; border:3px solid #fff"/>');var av=jsDom.nodeById("userimage");var ax=av.naturalWidth/30;var au=Math.round(av.naturalHeight/ax);jsDom.css(av,{width:"30px",height:au+"px",display:"block"});jsDom.setAttr(av,{width:"30",height:au});aw.addEventListener("click",function(){at.lastused="image";ab(at);ap.saveImage(at.image);g=at.frame;jsDom.remove(this)});aw.addEventListener("touchstart",function(){at.lastused="image";ab(at);ap.saveImage(at.image);g=at.frame;jsDom.remove(this)})}function V(at,av,au,ax,aw){E(av,au,ax,aw)}function af(at,av,au,ax,aw){E(av,au,ax,aw)}function z(at,av,au,ax,aw){E(av,au,ax,aw)}function u(at,av,au,ax,aw){E(av,au,ax,aw)}function r(at,av,au,ax,aw){E(av,au,ax,aw)}function w(at){y.style.cssText=c;y.style.display="block";EventListener.dispatch("INIT_RESIZER",this,y)}function E(au,at,ax,aw){if(y){var av=0;jsDom.css(y,{display:"block",left:ax,top:aw,"-ms-transform":"rotate("+at+"deg) scale("+au/100+", "+au/100+") rotateY("+av+"deg)","-webkit-transform":"rotate("+at+"deg) scale("+au/100+", "+au/100+") rotateY("+av+"deg)",transform:"rotate("+at+"deg) scale("+au/100+", "+au/100+") rotateY("+av+"deg)"})}}function o(aA,aG,aJ,aw){var ax=jsDom.nodeById("confirmationArea");var aF=jsDom.nodeById("tryon_webcam");if(ax||aF){return}y=jsDom.nodeById("frame");if(y!=null){var aL=y.style.left;var aB=y.style.top;jsDom.remove(y)}aG=aG.split("http:").join("").split("https:").join("").split("file:/").join("");var aE=5;if(aw!=""){var aC=aw.split("/");aE=parseInt(aC[1])}var av=0;var aM=new Image();aM.onload=function(){var aO=Tools.reduceImage(aM,0.6);var aN=jsDom.nodeById("frame");jsDom.setAttr(aN,{src:aO})};aM.crossOrigin="Anonymous";aM.src=aG;if(K){var aH=al.modeldata.split(",");var az=aH[i];var aI=az.split(":");var aK=aI[0].split("-");var at=aI[1].split("-");var aD=2.2*(parseFloat(at[0]-parseFloat(aK[0])));var au=aK[0]-(aD/3.8);var ay=aK[1];y=jsDom.createNode("img",{id:"frame",src:aG},"","parent",D);jsDom.css(y,{display:"none",position:"absolute",opacity:"0.84",left:au+"px",width:aD+"px"});y.onload=function(){var aN=y.naturalWidth;var aP=y.naturalHeight;var aO=aD/aN;av=aP*aO;y.style.imageRendering="optimizeQuality";jsDom.css(y,{top:parseFloat(ay)-(av/aE)+"px",height:av+"px",display:"block",opacity:"0.96"});jsDom.setAttr(y,{width:aD,height:av});c=y.style.cssText;EventListener.dispatch("INIT_RESIZER",this,y,au,ay);X=new dragObject("frame")};return}else{T=true;var aD=2.2*(parseFloat(g.Rleft)-parseFloat(g.Lleft));var au=(g.Lleft)-(aD/4.4);var ay=g.Ltop;y=jsDom.createNode("img",{id:"frame",src:aG},"","parent",D);jsDom.css(y,{display:"none",position:"absolute",opacity:"0.84",left:au+"px",width:aD+"px"});y.onload=function(){var aN=y.naturalWidth;var aP=y.naturalHeight;var aO=aD/aN;av=aP*aO;y.style.imageRendering="optimizeQuality";jsDom.css(y,{top:parseFloat(ay)-(av/aE)+"px",height:av+"px",position:"absolute",display:"block",opacity:"0.96"});jsDom.setAttr(y,{width:aD,height:av});EventListener.dispatch("INIT_RESIZER",this,y,au,ay);X=new dragObject("frame")}}}this.setupLayout()};var WebcamToImage=function(e){var h=this;var m=e;var r=settings_tryon;var t=null;var i=null;var v=400;var n=300;var a=false;var c=false;var b=false;navigator.getUserMedia=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia);WebcamToImage.prototype.setupCam=function(){u();if(!EventListener.hasEventListener("WEBCAM_CLOSE",p,h,true)){EventListener.addEventListener("WEBCAM_CLOSE",p,h,true);EventListener.addEventListener("WEBCAM_TAKE_PICTURE",o,h);EventListener.addEventListener("FLASH_CAM_DENIED",d);if(navigator.getUserMedia){t=jsDom.createNode("video",{id:"tryon_webcam",width:v,height:n,style:"position:absolute;"},"","parent",m);jsDom.css(t,{transform:"rotateY(0deg)","-webkit-transform":"rotateY(0deg);","-moz-transform":"rotateY(0deg)",display:"none;"});i=jsDom.createNode("canvas",{id:"tryon_canvas",width:r.width+"",height:r.height+"",style:"position:absolute;display:none;"},"","parent",m);var y=jsDom.getStyle(m,"width",true);var z=jsDom.getStyle(m,"height",true);var x=g(v,n,y,z,false);if(x){t.width=x.width;t.height=x.height;jsDom.css(t,{left:x.targetleft+"px"});jsDom.css(t,{top:x.targettop+"px"})}q(t)}else{s()}}};function q(z){var x=function(A){A=A;if(A.getVideoTracks().length==0){EventListener.dispatch("noCamFound",this);p(true);return}if(window.URL){z.src=window.URL.createObjectURL(A)}else{z.src=A}jsDom.css(z,{display:"block"});z.play();b=true;EventListener.dispatch("WEBCAM_READY",this);j()};var y=function(A){if(A.name=="PermissionDeniedError"){EventListener.dispatch("cameraPermissionDenied",this)}b=false;p(true)};navigator.getUserMedia({audio:false,video:true},x,y)}function j(){var x=jsDom.createNode("div",{style:"position:absolute; top:0;left:0;background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAAHe9q7oAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkRFMzM4RUI1NTIzODExRTRBRTVBRTRFMjA0NzM2OTVBIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkRFMzM4RUI2NTIzODExRTRBRTVBRTRFMjA0NzM2OTVBIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6REUzMzhFQjM1MjM4MTFFNEFFNUFFNEUyMDQ3MzY5NUEiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6REUzMzhFQjQ1MjM4MTFFNEFFNUFFNEUyMDQ3MzY5NUEiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6Dw1B6AAAAK0lEQVR42mJQVVbpBwggBhABEECMYBYQAAQQnMHEAAUAAcYCE4EBJgY0AAAI3ATyMVu6KgAAAABJRU5ErkJggg==); width:"+r.width+"px; height:20px;"},"","parent",m);var z=jsDom.createNode("label",{style:"color:#fff; font-size:12px;float:right; width:89px; line-height:20px; font-family:Arial; display:block;"},"","parent",x);jsDom.html(z,"Low light");var B=jsDom.createNode("input",{type:"checkbox",id:"lowlight",style:"float:left;"},"","parent",z);var y=jsDom.createNode("label",{style:"color:#fff;float:left; font-size:12px; line-height:20px; width:89px; font-family:Arial; display:block;"},"","parent",x);jsDom.html(y,"Mirror mode");var A=jsDom.createNode("input",{type:"checkbox",id:"mirrormode",style:"float:left"},"","parent",y);A.addEventListener("click",function(C){a=jsDom.getProperty(A,"checked");w(a);l(C)});A.addEventListener("touchstart",function(C){a=jsDom.getProperty(A,"checked");w(a);l(C)});lowlight.addEventListener("click",function(C){c=jsDom.getProperty(lowlight,"checked");k(c);l(C)});lowlight.addEventListener("touchstart",function(C){c=jsDom.getProperty(lowlight,"checked");k(c);l(C)})}function w(x){if(x){jsDom.css(t,{transform:"scaleX(-1)","-webkit-transform":"scaleX(-1);","-moz-transform":"scaleX(-1)",display:"block;"})}else{jsDom.css(t,{transform:"scaleX(1)","-webkit-transform":"scaleX(1);","-moz-transform":"scaleX(1)",display:"block;"})}}function k(x){if(x){jsDom.css(t,{filter:"url(#brightness)","-webkit-filter":" brightness(150%)",display:"block;"})}else{jsDom.removeStyle(t,"filter");jsDom.css(t,{"-webkit-filter":" brightness(100%)",display:"block;"})}}function s(){t=jsDom.createNode("div",{id:"tryon_webcam",width:r.width,height:r.height,style:"position:absolute;top:0px;display:block;"},"","parent",m);jsDom.html(t,'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+r.width+'" height="'+r.height+'" id="webcam_flash"><param name="movie" value="'+r.webcampath+'" /><param name="wmode" value="opaque" /><!--[if !IE]>--><object type="application/x-shockwave-flash" data="'+r.webcampath+'" width="'+r.width+'" height="'+r.height+'" id="webcam_flash"><param name="wmode" value="opaque" /><!--<![endif]--><!--[if !IE]>--></object><!--<![endif]--></object>');EventListener.addEventListener("WEBCAM_READY",function(){b=true})}function o(y){if(b){if(!navigator.getUserMedia){var A=jsDom.nodeById("webcam_flash");if(A!=null){var D=A._snap();p(false);var B="data:image/jpg;base64,"+D;EventListener.dispatch("ASK_FOR_CONFIRM",this,B,{mirror:false,enhancelight:false})}}else{var C=t.videoHeight/r.height;if(a){i.width=t.videoWidth;i.height=t.videoHeight;var x=i.getContext("2d");x.scale(-1,1);x.drawImage(t,0,0,-1*t.videoWidth,t.videoHeight)}else{i.getContext("2d").drawImage(t,-1*parseInt(t.style.left)*C,-1*parseInt(t.style.top)*C,parseInt(r.width)*C,parseInt(r.height)*C,0,0,r.width,r.height)}var z=i.toDataURL("image/png");p(false);EventListener.dispatch("ASK_FOR_CONFIRM",this,z,{mirror:a,enhancelight:c})}}else{EventListener.dispatch("requestAllowCamera",this)}}function p(z){if(navigator.getUserMedia){if(stream){stream.stop()}var x=jsDom.nodeById("tryon_webcam");if(z==true){EventListener.dispatch("RESET_VIEW_DEFAULT",this)}EventListener.dispatch("WEBCAM_CLOSED",this)}else{var y=jsDom.nodeById("tryon_webcam");jsDom.remove(y);EventListener.dispatch("WEBCAM_CLOSED",this)}}function u(){stream=null;EventListener.removeEventListener("WEBCAM_CLOSE",p,h);EventListener.removeEventListener("WEBCAM_TAKE_PICTURE",o,h)}function d(){var x=jsDom.nodeById("tryon_webcam");jsDom.remove(x);s()}function g(B,G,F,A,z){var H={width:0,height:0,fScaleToTargetWidth:true};if((B<=0)||(G<=0)||(F<=0)||(A<=0)){return H}var y=F;var E=(G*F)/B;var x=(B*A)/G;var D=A;var C=(x>F);if(C){C=z}else{C=!z}if(C){H.width=Math.floor(y);H.height=Math.floor(E);H.fScaleToTargetWidth=true}else{H.width=Math.floor(x);H.height=Math.floor(D);H.fScaleToTargetWidth=false}H.targetleft=Math.floor((F-H.width)/2);H.targettop=Math.floor((A-H.height)/2);return H}function l(x){if(x.stopPropagation){x.stopPropagation()}else{if(window.event){window.event.cancelBubble=true}}}function f(){stream=null;EventListener.removeEventListener("WEBCAM_CLOSE",p,h);EventListener.removeEventListener("WEBCAM_TAKE_PICTURE",o,h)}h.setupCam()};onmessage=function(a){console.log("Message received from main script"+a);var b=new tracking.ObjectTracker(["eye"]);b.setStepSize(1.7);tracking.track("#previewImage",b);b.on("track",function(c){c.data.forEach(function(d){window.plot(d.x,d.y,d.width,d.height)})});window.plot=function(c,g,d,e){var f=document.createElement("div");document.querySelector("mainArea").appendChild(f);f.classList.add("rect");f.style.width=d+"px";f.style.height=e+"px";f.style.left=(previewImage.offsetLeft+c)+"px";f.style.top=(previewImage.offsetTop+g)+"px"};postMessage(rect)};